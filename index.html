<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Breach: The Game</title>
  <style>
    body { display: flex; flex-direction: row; justify-content: center; gap: 30px; font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 20px; }
    .game-container { display: flex; flex-direction: column; max-width: 960px; }
    .controls button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    #timer { font-size: 18px; margin: 10px 0; }
    #game-area { position: relative; width: 960px; height: 540px; border: 1px solid #ccc; margin-bottom: 10px; }
    #background { width: 100%; height: 100%; }
    #character { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); height: 60%; pointer-events: none; }
    #options-box button { background: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 10px; margin: 5px auto; display: block; width: 100%; max-width: 400px; cursor: pointer; }
    #options-box button:hover { background: #f0f0f0; }
    #dialogue-box { background: rgba(255,255,255,0.95); padding: 20px; border:2px solid #444; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); font-size:16px; line-height:1.5; white-space: pre-wrap; min-height:100px; }
    .sidebar { min-width: 300px; }
    #clue-sheet { border:1px solid #ccc; background:#fff; padding:10px; }
    #clue-sheet h3 { margin-top:0; }
    #clue-sheet ul { padding-left:20px; }
    #clue-sheet li span { font-weight: bold; }
    #submit-report { margin-top:10px; padding:10px 20px; font-size:16px; width:100%; box-sizing:border-box; }
    /* Speaker colors */
    .speaker-logan { color: #1f77b4; }
    .speaker-corey { color: #d62728; }
    .speaker-coyle { color: #2ca02c; }
    .speaker-reyes { color: #9467bd; }
    .speaker-crutchfield { color: #ff7f0e; }
    .speaker-you { color: #000000; font-weight: bold; }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>The Breach: The Game</h1>
    <div id="timer">Time left: 30:00</div>
    <div class="controls">
      <button onclick="navigateTo('Lobby')">Lobby</button>
      <button onclick="navigateTo('Main Office')">Main Office</button>
      <button onclick="navigateTo('Break Room')">Break Room</button>
      <button onclick="navigateTo('HR Office')">HR Office</button>
      <button onclick="navigateTo('Server Room')">Server Room</button>
      <button onclick="navigateTo('Crutchfield\'s Office')">Crutchfield's Office</button>
    </div>
    <div id="game-area">
      <img id="background" src="" alt="Room Background">
      <img id="character" src="" alt="Character">
    </div>
    <div id="options-box"></div>
    <div id="dialogue-box"></div>
  </div>
  <div class="sidebar">
    <div id="clue-sheet">
      <h3>Clue Sheet</h3>
      <ul id="clue-list"></ul>
    </div>
    <button id="submit-report" onclick="openFinalReport()">Submit Final Report</button>
  </div>
  <script>
    const state = { clueSheet: [], loganDialogues:{}, coreyDialogues:{}, coyleDialogues:{}, reyesDialogues:{}, crutchfieldDialogues:{} };
    let currentRoom = '';
    let roomDialoguesHtml = {};
    let timeLeft = 1800;
    let timerInterval;

    function formatLine(text) {
      const line = text.replace(/^([^:]+):/, (m, p1) => {
        const key = p1.toLowerCase().replace(/[^a-z]/g, '');
        return `<span class="speaker-${key}">${p1}:</span>`;
      });
      return line;
    }

    function logDialogue(text) {
      const lineHtml = formatLine(text);
      if (!roomDialoguesHtml[currentRoom]) roomDialoguesHtml[currentRoom] = lineHtml;
      else roomDialoguesHtml[currentRoom] += '<br>' + lineHtml;
      document.getElementById('dialogue-box').innerHTML = roomDialoguesHtml[currentRoom];
    }

    function clearOptions() { document.getElementById('options-box').innerHTML = ''; }

    function addOption(label, cb) {
      const btn = document.createElement('button');
      btn.textContent = label;
      btn.onclick = function() {
        logDialogue('You: ' + label);
        cb();
      };
      document.getElementById('options-box').appendChild(btn);
    }

    function addClue(clue) {
      if (!state.clueSheet.includes(clue)) {
        state.clueSheet.push(clue);
        const li = document.createElement('li');
        let html = clue.replace(/\b(Logan|Corey|Coyle|Reyes|Crutchfield)\b/g, (m) => {
          return `<span class="speaker-${m.toLowerCase()}">${m}</span>`;
        });
        li.innerHTML = html;
        document.getElementById('clue-list').appendChild(li);
      }
    }

    function highlightRoomButton(room) {
      document.querySelectorAll('.controls button').forEach(b => b.style.backgroundColor = b.textContent === room ? '#d0eaff' : '');
    }

    function updateTimer() {
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        logDialogue('⏰ Time is up! Session ended.');
        clearOptions();
        return;
      }
      const min = Math.floor(timeLeft/60), sec = timeLeft%60;
      document.getElementById('timer').innerText = `Time left: ${String(min).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
      timeLeft--;
    }
    function startTimer() { updateTimer(); timerInterval = setInterval(updateTimer,1000); }

    function navigateTo(room) { /* unchanged navigation code */ }
    function talkToLogan() { /* unchanged dialogue */ }
    function talkToCorey() { /* unchanged dialogue */ }
    function talkToCoyle() { /* unchanged dialogue */ }
    function talkToReyes() { /* unchanged dialogue */ }
    function talkToCrutchfield() { /* unchanged dialogue */ }

    function openFinalReport() {
      clearOptions();
      logDialogue('Submit final report: Who & how?');
      const container = document.getElementById('options-box');
      const cs = document.createElement('select');
      cs.id = 'accusedCharacter';
      ['Logan','Corey','Coyle','Reyes','Crutchfield'].forEach(n => {
        const o = document.createElement('option');
        o.value = n;
        o.textContent = n;
        cs.appendChild(o);
      });
      container.appendChild(cs);
      const ss = document.createElement('select');
      ss.id = 'breachScenario';
      ['Clicked a phishing email disguised as a new hire packet','Downloaded malware from USB drive','Reused credentials from past breach','Forwarded scam','Missed invoice scam','Ignored alert','Vishing call','Weak password','Malicious attachment','External access'].forEach(s => {
        const o = document.createElement('option');
        o.value = s;
        o.textContent = s;
        ss.appendChild(o);
      });
      container.appendChild(ss);
      const sb = document.createElement('button');
      sb.textContent = 'Submit';
      sb.onclick = () => submitAccusation(cs.value, ss.value);
      container.appendChild(sb);
    }

    function submitAccusation(n, r) {
      clearOptions();
      if (n === 'Logan' && r === 'Clicked a phishing email disguised as a new hire packet') {
        logDialogue('✅ Correct! Logan was the culprit.');
      } else {
        logDialogue(`❌ Not quite. ${n} & that method incorrect.`);
      }
    }

    function startGame() { startTimer(); navigateTo('Lobby'); }
    document.addEventListener('DOMContentLoaded', startGame);
  </script>
</body>
</html>
