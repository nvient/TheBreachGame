<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Breach: The Game</title>
  <style>
    body { display: flex; flex-direction: row; justify-content: center; gap: 30px; font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 20px; }
    .game-container { display: flex; flex-direction: column; max-width: 960px; }
    .controls button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    #timer { font-size: 18px; margin: 10px 0; }
    #game-area { position: relative; width: 960px; height: 540px; border: 1px solid #ccc; margin-bottom: 10px; }
    #background { width: 100%; height: 100%; }
    #character { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); height: 60%; pointer-events: none; }
    #options-box button { background: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 10px; margin: 5px auto; display: block; width: 100%; max-width: 400px; cursor: pointer; }
    #options-box button:hover { background: #f0f0f0; }
    #dialogue-box { background: rgba(255,255,255,0.95); padding: 20px; border:2px solid #444; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); font-size:16px; line-height:1.5; white-space: pre-wrap; min-height:100px; }
    .sidebar { min-width: 300px; }
    #clue-sheet { border:1px solid #ccc; background:#fff; padding:10px; }
    #clue-sheet h3 { margin-top:0; }
    #clue-sheet ul { padding-left:20px; }
    #clue-sheet li span { font-weight: bold; }
    #submit-report { margin-top:10px; padding:10px 20px; font-size:16px; width:100%; box-sizing:border-box; }
    /* Speaker colors */
    .speaker-logan { color: #1f77b4; }
    .speaker-corey { color: #d62728; }
    .speaker-coyle { color: #2ca02c; }
    .speaker-reyes { color: #9467bd; }
    .speaker-crutchfield { color: #ff7f0e; }
    .speaker-you { color: #000000; font-weight: bold; }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>The Breach: The Game</h1>
    <div id="timer">Time left: 30:00</div>
    <div class="controls">
      <button onclick="navigateTo('Lobby')">Lobby</button>
      <button onclick="navigateTo('Main Office')">Main Office</button>
      <button onclick="navigateTo('Break Room')">Break Room</button>
      <button onclick="navigateTo('HR Office')">HR Office</button>
      <button onclick="navigateTo('Server Room')">Server Room</button>
      <button onclick="navigateTo('Crutchfield\'s Office')">Crutchfield's Office</button>
    </div>
    <div id="game-area">
      <img id="background" src="" alt="Room Background">
      <img id="character" src="" alt="Character">
    </div>
    <div id="options-box"></div>
    <div id="dialogue-box"></div>
  </div>
  <div class="sidebar">
    <div id="clue-sheet">
      <h3>Clue Sheet</h3>
      <ul id="clue-list"></ul>
    </div>
    <button id="submit-report" onclick="openFinalReport()">Submit Final Report</button>
  </div>
  <script>
    const state = {
      clueSheet: [],
      loganDialogues: {},
      coreyDialogues: {},
      coyleDialogues: {},
      reyesDialogues: {},
      crutchfieldDialogues: {}
    };
    let currentRoom = '';
    let roomDialoguesHtml = {};
    let timeLeft = 1800;
    let timerInterval;

    function formatLine(text) {
      return text.replace(/^([^:]+):/, (m, p1) => {
        const key = p1.toLowerCase().replace(/[^a-z]/g, '');
        return `<span class="speaker-${key}">${p1}:</span>`;
      });
    }

    function logDialogue(text) {
      const lineHtml = formatLine(text);
      if (!roomDialoguesHtml[currentRoom]) roomDialoguesHtml[currentRoom] = lineHtml;
      else roomDialoguesHtml[currentRoom] += '<br>' + lineHtml;
      document.getElementById('dialogue-box').innerHTML = roomDialoguesHtml[currentRoom];
    }

    function clearOptions() {
      document.getElementById('options-box').innerHTML = '';
    }

    function addOption(label, cb) {
      const btn = document.createElement('button');
      btn.textContent = label;
      btn.onclick = function() {
        logDialogue('You: ' + label);
        cb();
      };
      document.getElementById('options-box').appendChild(btn);
    }

    function addClue(clue) {
      if (!state.clueSheet.includes(clue)) {
        state.clueSheet.push(clue);
        const li = document.createElement('li');
        const html = clue.replace(/\b(Logan|Corey|Coyle|Reyes|Crutchfield)\b/g, m => `<span class="speaker-${m.toLowerCase()}">${m}</span>`);
        li.innerHTML = html;
        document.getElementById('clue-list').appendChild(li);
      }
    }

    function highlightRoomButton(room) {
      document.querySelectorAll('.controls button').forEach(b => b.style.backgroundColor = b.textContent === room ? '#d0eaff' : '');
    }

    function updateTimer() {
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        logDialogue('⏰ Time is up! Session ended.');
        clearOptions();
        return;
      }
      const min = Math.floor(timeLeft / 60), sec = timeLeft % 60;
      document.getElementById('timer').innerText = `Time left: ${String(min).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
      timeLeft--;
    }

    function startTimer() {
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
    }

    function navigateTo(room) {
      currentRoom = room;
      highlightRoomButton(room);
      roomDialoguesHtml[room] = '';
      document.getElementById('dialogue-box').innerHTML = '';
      clearOptions();
      const bg = document.getElementById('background');
      const char = document.getElementById('character');
      switch (room) {
        case 'Lobby':
          bg.src = 'assets/rooms/lobby.png';
          char.src = 'assets/characters/reyes.png';
          logDialogue("Reyes: 'There's been a security incident and we need your help. Navigate to the different rooms and talk with our agents — they may have clues about what happened. You have 30 minutes to solve this case! Good luck!'");
          addOption('Start Investigation', () => {
            clearOptions();
            logDialogue("Reyes: 'Remember, check every room and gather as many clues as you can.'");
            addOption('Talk to Reyes', talkToReyes);
          });
          break;
        case 'Main Office':
          bg.src = 'assets/rooms/main_office.png';
          char.src = 'assets/characters/logan.png';
          logDialogue("Logan: 'You’re here about the breach?'");
          addOption('Talk to Logan', talkToLogan);
          break;
        case 'Break Room':
          bg.src = 'assets/rooms/break_room.png';
          char.src = '';
          logDialogue("A quiet room. You notice a USB drive on the table.");
          addOption('View USB Drive', () => {
            clearOptions();
            logDialogue("USB Drive: 'Secret Drive for Agent Coyle'");
            addClue("Secret Drive labeled for Agent Coyle");
            addOption('Ask why it’s here', () => {
              clearOptions();
              logDialogue("You recall Coyle mentioning secure backups here last week.");
              addClue("Coyle uses secure backup in break room.");
              addOption('View USB Drive Again', () => navigateTo('Break Room'));
            });
          });
          break;
        case 'HR Office':
          bg.src = 'assets/rooms/hr_office.png';
          char.src = 'assets/characters/corey.png';
          logDialogue("You find Corey examining some personnel files. A file cabinet stands nearby.");
          addOption('Talk to Corey', talkToCorey);
          addOption('Open File Cabinet', () => {
            clearOptions();
            logDialogue("File Cabinet: 'Logan – Pending'");
            addClue("HR File: Logan's record shows his new hire packet was never sent.");
            addClue("HR File: Reyes has completed all training modules. Corey's security training is overdue by 2 weeks.");
            addOption('Inspect anonymous note', () => {
              clearOptions();
              logDialogue("Anonymous Note: 'Check the dark web logs.'");
              addClue("Found unsigned internal memo suggesting to check dark web.");
              addOption('Back', () => navigateTo('HR Office'));
            });
          });
          break;
        case 'Server Room':
          bg.src = 'assets/rooms/server_room.png';
          char.src = 'assets/characters/coyle.png';
          logDialogue("Agent Coyle stands beside a humming server rack. A terminal glows in the corner.");
          addOption('Talk to Coyle', talkToCoyle);
          addOption('Access Dark Web Terminal', () => {
            clearOptions();
            logDialogue("Dark Web Terminal: 'Password dump reveals hashed creds for Coyle & Reyes; Logan not listed.'");
            addClue("Dark Web Terminal: Multiple employees have credentials in past breaches.");
            addOption('Ask why Corey appears', () => {
              clearOptions();
              logDialogue("You recall Corey mentioning black hat days—maybe he forgot to scrub logs.");
              addClue("Corey’s past hacking visible on dark web.");
              addOption('Back', () => navigateTo('Server Room'));
            });
          });
          break;
        case 'Crutchfield\'s Office':
          bg.src = 'assets/rooms/crutchfield_office.png';
          char.src = 'assets/characters/crutchfield.png';
          logDialogue("Deputy Director Crutchfield stands at her desk, reviewing a report.");
          addOption('Talk to Crutchfield', talkToCrutchfield);
          addOption('Review her notes', () => {
            clearOptions();
            logDialogue("Her Notepad: 'Unusual VPN login from unrecognized IP.'");
            addClue("Crutchfield’s notes mention unusual VPN activity last week.");
            addOption('Back', () => navigateTo("Crutchfield's Office"));
          });
          break;
        default:
          logDialogue("This room doesn't exist yet.");
      }
    }

    function talkToLogan() {
      clearOptions();
      const d = state.loganDialogues;
      if (!d.intro) {
        logDialogue("Logan: 'What can I do for you?'");
        d.intro = true;
      }
      if (!d.role) {
        addOption('Ask about his role here', () => {
          clearOptions();
          logDialogue("Logan: 'I'm the new agent in training, here to learn from the team.'");
          d.role = true;
          talkToLogan();
        });
      }
      if (!d.computerIssue) {
        addOption('Ask about the computer glitch', () => {
          clearOptions();
          logDialogue("Logan: 'It froze after I opened what I thought was my New Hire packet.'");
          d.computerIssue = true;
          talkToLogan();
        });
      }
      if (state.clueSheet.includes("HR File: Logan's record shows his new hire packet was never sent.") && !d.onboarding) {
        addOption('Ask about onboarding email', () => {
          clearOptions();
          logDialogue("Logan: 'I clicked that packet email without realizing it was fake. I'm so sorry.'");
          addClue("Logan admits to clicking the phishing email disguised as a new hire packet.");
          d.onboarding = true;
          talkToLogan();
        });
      }
      if (d.onboarding && !d.aftermath) {
        addOption('Ask what happened after', () => {
          clearOptions();
          logDialogue("Logan: 'My files locked up and I saw ransom notes everywhere.'");
          addClue("Ransomware locked user files and displayed ransom notes.");
          d.aftermath = true;
          talkToLogan();
        });
      }
      if (d.intro && d.role && d.computerIssue && d.onboarding && d.aftermath) {
        logDialogue("Logan: 'That’s all I can provide right now.'");
        addOption('Talk again', talkToLogan);
      }
    }

    function talkToCorey() {
      clearOptions();
      const d = state.coreyDialogues;
      if (!d.behavior) {
        logDialogue("Corey: 'First breach rodeo, am I right?' ");
        addOption('Ask about suspicious behavior', () => {
          clearOptions();
          logDialogue("Corey: 'Logan showed me an email that seemed off...' ");
          addClue("Corey warned Logan not to open the suspicious email.");
          d.behavior = true;
          talkToCorey();
        });
      }
      if (!d.pastIncidents) {
        addOption('Ask about past incidents', () => {
          clearOptions();
          logDialogue("Corey: 'We had a similar spoof last quarter.'");
          addClue("Past spoof caught by Reyes.");
          d.pastIncidents = true;
          talkToCorey();
        });
      }
      if (!d.phishingTips) {
        addOption('Ask phishing tips', () => {
          clearOptions();
          logDialogue("Corey: 'Always follow the SLAM method: Sender, Links, Attachments, Message.'");
          d.phishingTips = true;
          talkToCorey();
        });
      }
      if (!d.clickedBefore) {
        addOption('Ask past slips', () => {
          clearOptions();
          logDialogue("Corey: 'I once clicked a test link in training and felt foolish.'");
          addClue("Corey's past slip in training.");
          d.clickedBefore = true;
          talkToCorey();
        });
      }
      if (!d.weakPassword) {
        addOption('Ask about password strength', () => {
          clearOptions();
          logDialogue("Corey: 'I admit my password is just 8 characters, policy says 12, but it wasn't exploited.'");
          addClue("Corey's weak password was noted but not used in breach.");
          d.weakPassword = true;
          talkToCorey();
        });
      }
      if (d.behavior && d.pastIncidents && d.phishingTips && d.clickedBefore && d.weakPassword) {
        logDialogue("Corey: 'That’s all I’ve got for now.'");
        addOption('Talk again', talkToCorey);
      }
    }

    function talkToCoyle() {
      clearOptions();
      const d = state.coyleDialogues;
      if (!d.logs) {
        logDialogue("Coyle: 'Server load spiked like a heart monitor.'");
        addOption('Ask when it spiked', () => {
          clearOptions();
          logDialogue("Coyle: 'Exactly 9:05 AM.'");
          addClue("Attack initiated at 9:05 AM.");
          d.logs = true;
          talkToCoyle();
        });
      }
      if (!d.message) {
        addOption("Ask about Logan's message", () => {
          clearOptions();
          logDialogue("Coyle: 'He asked if a file was safe; I said yes.'");
          addClue("Coyle okayed the suspicious email.");
          d.message = true;
          talkToCoyle();
        });
      }
      if (!d.filters) {
        addOption('Ask about filters', () => {
          clearOptions();
          logDialogue("Coyle: 'Our filters miss spear-phish by design.'");
          d.filters = true;
          talkToCoyle();
        });
      }
      if (!d.logins) {
        addOption('Ask about login attempts', () => {
          clearOptions();
          logDialogue("Coyle: 'Found failed admin login at 9:02.'");
          addClue("Failed admin login attempt at 9:02 AM.");
          d.logins = true;
          talkToCoyle();
        });
      }
      if (!d.ignoredAlert) {
        addOption('Ask about ignored alerts', () => {
          clearOptions();
          logDialogue("Coyle: 'An endpoint alert popped up but looked like maintenance.'");
          addClue("Coyle ignored an endpoint alert, but it was unrelated.");
          d.ignoredAlert = true;
          talkToCoyle();
        });
      }
      if (d.logs && d.message && d.filters && d.logins && d.ignoredAlert) {
        logDialogue("Coyle: 'That’s my piece.'");
        addOption('Talk again', talkToCoyle);
      }
    }

    function talkToReyes() {
      clearOptions();
      const d = state.reyesDialogues;
      if (!d.intro) {
        logDialogue("Reyes: 'I’ve seen patterns in every breach.'");
        d.intro = true;
      }
      if (!d.behavior) {
        addOption('Ask about pattern', () => {
          clearOptions();
          logDialogue("Reyes: 'It always starts with a click.'");
          addClue("Phishing starts with a click.");
          d.behavior = true;
          talkToReyes();
        });
      }
      if (!d.training) {
        addOption('Ask about training', () => {
          clearOptions();
          logDialogue("Reyes: 'We need live simulations.'");
          d.training = true;
          talkToReyes();
        });
      }
      if (!d.agents) {
        addOption('Ask about Coyle', () => {
          clearOptions();
          logDialogue("Reyes: 'He moves fast, sometimes too fast.'");
          addClue("Coyle moves too fast, warns of rushed decisions.");
          d.agents = true;
          talkToReyes();
        });
      }
      if (!d.watch) {
        addOption("Ask why she's watchful", () => {
          clearOptions();
          logDialogue("Reyes: 'New hires are my concern.'");
          d.watch = true;
          talkToReyes();
        });
      }
      if (!d.vishing) {
        addOption('Ask about vishing calls', () => {
          clearOptions();
          logDialogue("Reyes: 'I did get a vishing call, but that was at 9:45 AM, after the breach.'");
          addClue("Reyes received a vishing call at 9:45 AM, which occurred after the breach.");
          d.vishing = true;
          talkToReyes();
        });
      }
      if (d.behavior && d.training && d.agents && d.watch && d.vishing) {
        logDialogue("Reyes: 'Nothing else here.'");
        addOption('Talk again', talkToReyes);
      }
    }

    function talkToCrutchfield() {
      clearOptions();
      const d = state.crutchfieldDialogues;
      if (!d.intro) {
        logDialogue("Crutchfield: 'Onboarding is critical.'");
        d.intro = true;
      }
      if (!d.onboarding) {
        addOption('Ask quiz result', () => {
          clearOptions();
          logDialogue("Crutchfield: 'He aced it, shockingly.'");
          addClue("Logan passed the quiz but fell for phishing.");
          d.onboarding = true;
          talkToCrutchfield();
        });
      }
      if (!d.response) {
        addOption('Ask about isolation', () => {
          clearOptions();
          logDialogue("Crutchfield: 'We cut him off immediately.'");
          addClue("Systems isolated after breach.");
          d.response = true;
          talkToCrutchfield();
        });
      }
      if (!d.suspicion) {
        addOption('Ask if she mistrusts anyone', () => {
          clearOptions();
          logDialogue("Crutchfield: 'Corey's secrecy worries me.'");
          addClue("Crutchfield suspicious of Corey.");
          d.suspicion = true;
          talkToCrutchfield();
        });
      }
      if (!d.external) {
        addOption('Ask about external threat', () => {
          clearOptions();
          logDialogue("Crutchfield: 'We've seen coordinated bot attacks.'");
          d.external = true;
          talkToCrutchfield();
        });
      }
      if (d.onboarding && d.response && d.suspicion && d.external) {
        logDialogue("Crutchfield: 'That concludes my notes.'");
        addOption('Talk again', talkToCrutchfield);
      }
    }

    function openFinalReport() {
      clearOptions();
      logDialogue('Submit final report: Who & how?');
      const container = document.getElementById('options-box');
      const cs = document.createElement('select');
      cs.id = 'accusedCharacter';
      ['Logan','Corey','Coyle','Reyes','Crutchfield'].forEach(n => {
        const o = document.createElement('option');
        o.value = n;
        o.textContent = n;
        cs.appendChild(o);
      });
      container.appendChild(cs);
      const ss = document.createElement('select');
      ss.id = 'breachScenario';
      ['Clicked a phishing email disguised as a new hire packet','Downloaded malware from USB drive','Reused credentials from past breach','Forwarded scam','Missed invoice scam','Ignored alert','Vishing call','Weak password','Malicious attachment','External access'].forEach(s => {
        const o = document.createElement('option');
        o.value = s;
        o.textContent = s;
        ss.appendChild(o);
      });
      container.appendChild(ss);
      const sb = document.createElement('button');
      sb.textContent = 'Submit';
      sb.onclick = () => submitAccusation(cs.value, ss.value);
      container.appendChild(sb);
    }

    function submitAccusation(n, r) {
      clearOptions();
      if (n === 'Logan' && r === 'Clicked a phishing email disguised as a new hire packet') {
        logDialogue('✅ Correct! Logan was the culprit.');
      } else {
        logDialogue(`❌ Not quite. ${n} & that method incorrect.`);
      }
    }

    function startGame() { startTimer(); navigateTo('Lobby'); }
    document.addEventListener('DOMContentLoaded', startGame);
  </script>
</body>
</html>
