<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Breach: The Game</title>
  <style>
    body { display: flex; flex-direction: row; justify-content: center; gap: 30px; font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 20px; }
    .game-container { display: flex; flex-direction: column; max-width: 960px; }
    .controls button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    #game-area { position: relative; width: 960px; height: 540px; border: 1px solid #ccc; margin-bottom: 10px; }
    #background { width: 100%; height: 100%; }
    #character { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); height: 60%; pointer-events: none; }
    #options-box button { background: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 10px; margin: 5px auto; display: block; width: 100%; max-width: 400px; cursor: pointer; }
    #options-box button:hover { background: #f0f0f0; }
    #dialogue-box { background: rgba(255,255,255,0.95); padding: 20px; border:2px solid #444; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); font-size:16px; line-height:1.5; white-space:pre-line; min-height:100px; }
    .sidebar { min-width: 300px; }
    #clue-sheet { border:1px solid #ccc; background:#fff; padding:10px; }
    #clue-sheet h3 { margin-top:0; }
    #clue-sheet ul { padding-left:20px; }
    #submit-report { margin-top:10px; padding:10px 20px; font-size:16px; width:100%; box-sizing:border-box; }
  </style>
</head>
<body>
  <div class="game-container">
    <h1>The Breach: The Game</h1>
    <div class="controls">
      <button onclick="navigateTo('Lobby')">Lobby</button>
      <button onclick="navigateTo('Main Office')">Main Office</button>
      <button onclick="navigateTo('Break Room')">Break Room</button>
      <button onclick="navigateTo('HR Office')">HR Office</button>
      <button onclick="navigateTo('Server Room')">Server Room</button>
      <button onclick="navigateTo('Crutchfield\'s Office')">Crutchfield's Office</button>
    </div>
    <div id="game-area">
      <img id="background" src="" alt="Room Background">
      <img id="character" src="" alt="Character">
    </div>
    <div id="options-box"></div>
    <div id="dialogue-box">Click a room to begin your investigation.</div>
  </div>
  <div class="sidebar">
    <div id="clue-sheet">
      <h3>Clue Sheet</h3>
      <ul id="clue-list"></ul>
    </div>
    <button id="submit-report" onclick="openFinalReport()">Submit Final Report</button>
  </div>
  <script>
    const state = {
      clueSheet: [],
      loganDialogues: {}, coreyDialogues: {}, coyleDialogues: {}, reyesDialogues: {}, crutchfieldDialogues: {}
    };
    let currentRoom = '';
    let roomDialogues = {};

    function logDialogue(text) {
      if (!roomDialogues[currentRoom]) roomDialogues[currentRoom] = text;
      else roomDialogues[currentRoom] += "\n" + text;
      document.getElementById('dialogue-box').innerText = roomDialogues[currentRoom];
    }
    function clearOptions() { document.getElementById('options-box').innerHTML = ''; }
    function addOption(label, cb) { const btn = document.createElement('button'); btn.textContent = label; btn.onclick = cb; document.getElementById('options-box').appendChild(btn); }
    function addClue(clue) { if (!state.clueSheet.includes(clue)) { state.clueSheet.push(clue); const li=document.createElement('li'); li.textContent=`${state.clueSheet.length}. ${clue}`; document.getElementById('clue-list').appendChild(li);} }
    function highlightRoomButton(room) { document.querySelectorAll('.controls button').forEach(b=>b.style.backgroundColor=b.textContent===room?'#d0eaff':''); }

    function navigateTo(room) {
      currentRoom = room; highlightRoomButton(room);
      roomDialogues[room] = ''; document.getElementById('dialogue-box').innerText = '';
      clearOptions();
      const bg=document.getElementById('background'), char=document.getElementById('character');
      switch(room) {
        case 'Lobby':
          bg.src='assets/rooms/lobby.png'; char.src='assets/characters/reyes.png';
          logDialogue("Agent Reyes leans against the reception desk, watching you approach.");
          addOption('Talk to Reyes', talkToReyes);
          break;
        case 'Main Office':
          bg.src='assets/rooms/main_office.png'; char.src='assets/characters/logan.png';
          logDialogue("You see Logan at his desk, visibly nervous.");
          addOption('Talk to Logan', talkToLogan);
          break;
        case 'Break Room':
          bg.src='assets/rooms/break_room.png'; char.src='';
          logDialogue("A quiet room. You notice a USB drive on the table.");
          addOption('View USB Drive', ()=>{ addClue("Secret Drive labeled for Agent Coyle"); logDialogue("You inspect the USB. It's labeled 'Secret Drive for Agent Coyle'."); addOption('Ask why it’s here', ()=>{ clearOptions(); logDialogue("You recall Coyle mentioning secure backups here last week."); }); });
          break;
        case 'HR Office':
          bg.src='assets/rooms/hr_office.png'; char.src='assets/characters/corey.png';
          logDialogue("You find Corey examining some personnel files. A file cabinet stands nearby.");
          addOption('Talk to Corey', talkToCorey);
          addOption('Open File Cabinet', ()=>{ addClue("HR File: Logan's record shows his new hire packet was never sent. The phishing email he opened was fake."); addClue("HR File: Reyes has completed all training modules. Corey's security training is overdue by 2 weeks."); logDialogue("Inside the cabinet, you also see an anonymous note: 'Check the dark web logs.'</"); addOption('Inspect the note', ()=>{ clearOptions(); logDialogue("The handwriting matches an internal memo style, but unsigned."); addClue("Found unsigned internal memo suggesting to check dark web."); }); });
          break;
        case 'Server Room':
          bg.src='assets/rooms/server_room.png'; char.src='assets/characters/coyle.png';
          logDialogue("Agent Coyle stands beside a humming server rack. A terminal glows in the corner.");
          addOption('Talk to Coyle', talkToCoyle);
          addOption('Access Dark Web Terminal', ()=>{ addClue("Dark Web Terminal: Multiple employees have credentials in past breaches. Reyes and Coyle's passwords were found hashed. Logan is not listed."); logDialogue("The terminal reveals a password dump from last month. Corey appears in a hacker forum too."); addOption('Ask why Corey appears', ()=>{ clearOptions(); logDialogue("You recall Corey mentioning black hat days—maybe he forgot to scrub logs."); addClue("Corey’s past hacking might be visible on dark web."); }); });
          break;
        case 'Crutchfield\'s Office':
          bg.src='assets/rooms/crutchfield_office.png'; char.src='assets/characters/crutchfield.png';
          logDialogue("Deputy Director Crutchfield stands at her desk, reviewing a report.");
          addOption('Talk to Crutchfield', talkToCrutchfield);
          addOption('Review her notes', ()=>{ addClue("Crutchfield’s notes mention unusual VPN activity last week."); logDialogue("Her notepad references an odd VPN login from an unrecognized IP."); });
          break;
        default:
          logDialogue("This room doesn't exist yet.");
      }
    }

    function talkToLogan() {
      clearOptions(); const d=state.loganDialogues;
      if (!d.onboarding) { logDialogue("Logan: 'Man, what a crazy first day!'\n"); addOption('Ask about onboarding email', ()=>{ clearOptions(); logDialogue("Logan: 'I logged on at 9:00am, opened the New Hire Packet from HR then my computer started acting up.'"); addClue("Logan admits to clicking the phishing email."); d.onboarding=true; addOption('Ask about link domain', ()=>{ clearOptions(); logDialogue("Logan: 'I didn’t notice it was .ru instead of .com.'"); addClue("Link domain was .ru not .com."); }); }); }
      else if (!d.aftermath) { addOption('Ask what happened after', ()=>{ clearOptions(); logDialogue("Logan: 'It froze then... nothing, until now.'"); addOption('Ask if files changed', ()=>{ clearOptions(); logDialogue("Logan: 'My documents folder was renamed to LOCKED.'"); addClue("Ransomware renamed user folders."); }); d.aftermath=true; }); }
      else if (!d.feelings) { addOption('Ask who he suspects', ()=>{ clearOptions(); logDialogue("Logan: 'Agent Reyes has been too curious about my files.'"); addClue("Logan suspects Reyes due to her scrutiny."); d.feelings=true; }); }
      else if (!d.backgroundCheck) { addOption('Ask about prior training', ()=>{ clearOptions(); logDialogue("Logan: 'It was basic, no spear-phishing.'"); d.backgroundCheck=true; }); }
      else { logDialogue("Logan: 'I just hope this doesn’t ruin everything.'"); addOption('Talk again', talkToLogan); }
    }

    function talkToCorey() {
      clearOptions(); const d=state.coreyDialogues;
      if (!d.behavior) { logDialogue("Corey: 'First breach rodeo, am I right?'\n"); addOption('Ask about suspicious behavior', ()=>{ clearOptions(); logDialogue("Corey: 'Logan showed me an email that seemed off...'"); addClue("Corey warned Logan not to open the suspicious email."); addOption('Ask what was off', ()=>{ clearOptions(); logDialogue("Corey: 'The sender address used underscores and numbers.'"); addClue("Phishing address used underscores and numbers."); }); d.behavior=true; }); }
      if (!d.pastIncidents) { addOption('Ask about past incidents', ()=>{ clearOptions(); logDialogue("Corey: 'We had a similar spoof last quarter.'"); addOption('Ask outcome', ()=>{ clearOptions(); logDialogue("Corey: 'It was caught by Reyes before damage.'"); addClue("Past spoof caught by Reyes."); }); d.pastIncidents=true; }); }
      if (!d.phishingTips) { addOption('Ask phishing tips', ()=>{ clearOptions(); logDialogue("Corey: 'Always follow the SLAM method. Look at the Sender, Links, Attachments, and Message details.'"); d.phishingTips=true; }); }
      if (!d.clickedBefore) { addOption('Ask past slips', ()=>{ clearOptions(); logDialogue("Corey: 'I once clicked a test link in training and felt foolish.'"); }); d.clickedBefore=true; }
      if (d.behavior&&d.pastIncidents&&d.phishingTips) { logDialogue("Corey: 'That’s all I’ve got for now.'"); addOption('Talk again', talkToCorey); }
    }

    function talkToCoyle() {
      clearOptions(); const d=state.coyleDialogues;
      if (!d.logs) { logDialogue("Coyle: 'Server load spiked like a heart monitor.'\n"); addOption('Ask when it spiked', ()=>{ clearOptions(); logDialogue("Coyle: 'Exactly 9:05 AM.'"); addClue("Attack initiated at 9:05 AM."); }); d.logs=true; }
      if (!d.message) { addOption("Ask about Logan's message", ()=>{ clearOptions(); logDialogue("Coyle: 'He asked if a file was safe; I said yes.'"); addClue("Coyle okayed the suspicious email."); d.message=true; addOption('Ask if he regrets it', ()=>{ clearOptions(); logDialogue("Coyle: 'Big time.'"); }); }); }
      if (!d.filters) { addOption('Ask about filters', ()=>{ clearOptions(); logDialogue("Coyle: 'Our filters miss spear-phish by design.'"); d.filters=true; }); }
      if (!d.logins) { addOption('Ask about login attempts', ()=>{ clearOptions(); logDialogue("Coyle: 'Found failed admin login at 9:02.'"); addClue("Failed admin login attempt at 9:02 AM."); d.logins=true; }); }
      if (d.logs&&d.message&&d.filters&&d.logins) { logDialogue("Coyle: 'That’s my piece.'"); addOption('Talk again', talkToCoyle); }
    }

    function talkToReyes() {
      clearOptions(); const d=state.reyesDialogues;
      if (!d.behavior) { logDialogue("Reyes: 'I’ve seen patterns in every breach.'\n"); addOption('Ask about pattern', ()=>{ clearOptions(); logDialogue("Reyes: 'It always starts with a click.'"); addClue("Phishing starts with a click."); }); d.behavior=true; }
      if (!d.training) { addOption('Ask about training', ()=>{ clearOptions(); logDialogue("Reyes: 'We need live simulations.'"); d.training=true; }); }
      if (!d.agents) { addOption('Ask about Coyle', ()=>{ clearOptions(); logDialogue("Reyes: 'He moves fast, sometimes too fast.'"); addClue("Coyle moves too fast, warns of rushed decisions."); }); d.agents=true; }
      if (!d.watch) { addOption("Ask why she's watchful", () => { clearOptions(); logDialogue("Reyes: 'New hires are my concern.'"); d.watch=true; }); }
      if (d.behavior&&d.training&&d.agents&&d.watch) { logDialogue("Reyes: 'Nothing else here.'"); addOption('Talk again', talkToReyes); }
    }

    function talkToCrutchfield() {
      clearOptions(); const d=state.crutchfieldDialogues;
      if (!d.onboarding) { logDialogue("Crutchfield: 'Onboarding is critical.'\n"); addOption('Ask quiz result', ()=>{ clearOptions(); logDialogue("Crutchfield: 'He aced it, shockingly.'"); addClue("Logan passed the quiz but still failed."); }); d.onboarding=true; }
      if (!d.response) { addOption('Ask about isolation', ()=>{ clearOptions(); logDialogue("Crutchfield: 'We cut him off immediately.'"); addClue("Systems isolated after breach."); }); d.response=true; }
      if (!d.suspicion) { addOption('Ask if she mistrusts anyone', ()=>{ clearOptions(); logDialogue("Crutchfield: 'Corey’s secrecy worries me.'"); addClue("Crutchfield suspicious of Corey."); }); d.suspicion=true; }
      if (!d.external) { addOption('Ask about external threat', ()=>{ clearOptions(); logDialogue("Crutchfield: 'We’ve seen coordinated bot attacks.'"); d.external=true; }); }
      if (d.onboarding&&d.response&&d.suspicion&&d.external) { logDialogue("Crutchfield: 'That concludes my notes.'"); addOption('Talk again', talkToCrutchfield); }
    }

    function openFinalReport() {
      clearOptions(); logDialogue('Submit final report: Who & how?');
      const container=document.getElementById('options-box');
      const cs=document.createElement('select'); cs.id='accusedCharacter'; ['Logan','Corey','Coyle','Reyes'].forEach(n=>{const o=document.createElement('option');o.value=o.textContent=n;cs.appendChild(o);}); container.appendChild(cs);
      const ss=document.createElement('select'); ss.id='breachScenario'; ['Clicked a phishing email disguised as a new hire packet','Downloaded malware from USB drive','Reused credentials from past breach','Forwarded scam','Missed invoice scam','Ignored alert','Vishing call','Weak password','Malicious attachment','External access'].forEach(s=>{const o=document.createElement('option');o.value=o.textContent=s;ss.appendChild(o);}); container.appendChild(ss);
      const sb=document.createElement('button'); sb.textContent='Submit'; sb.onclick=()=>submitAccusation(cs.value, ss.value); container.appendChild(sb);
    }

    function submitAccusation(n, r) {
      clearOptions(); if(n==='Logan'&&r==='Clicked a phishing email disguised as a new hire packet') logDialogue('✅ Correct! Logan was the culprit.'); else logDialogue(`❌ Not quite. ${n} & that method incorrect.`);
    }

    function startGame(){navigateTo('Lobby');}
    document.addEventListener('DOMContentLoaded', startGame);
  </script>
</body>
</html>
